{% extends "base.html" %}
{% block title %}–£–ª—É—á—à–∏—Ç—å —Å–ø–ª–µ—Ç–Ω—é —Å AI - {{ gossip.title }}{% endblock %}

{% block content %}
<div class="enhance-ai-container">
    <div class="enhance-ai-header">
        <h1><i class="fas fa-magic"></i> –£–ª—É—á—à–∏—Ç—å —Å–ø–ª–µ—Ç–Ω—é —Å AI</h1>
        <p class="subtitle">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–ª—É—á—à–µ–Ω–∏—è –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</p>
    </div>

    <div class="enhance-ai-content">
        <!-- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å–ø–ª–µ—Ç–Ω—è -->
        <div class="original-gossip-section">
            <h2><i class="fas fa-file-alt"></i> –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å–ø–ª–µ—Ç–Ω—è</h2>
            <div class="gossip-card original">
                <h3>{{ gossip.title }}</h3>
                <div class="gossip-meta">
                    <span><i class="fas fa-user"></i> {{ gossip.author.username }}</span>
                    <span><i class="fas fa-clock"></i> {{ gossip.date_posted.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
                <div class="gossip-content">
                    {{ gossip_content_html|safe }}
                </div>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è -->
        <div class="enhancement-settings">
            <h2><i class="fas fa-cogs"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è</h2>
            
            <div class="settings-grid">
                                 <!-- –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å -->
                 <div class="setting-card base-cost">
                     <div class="setting-header">
                         <h3><i class="fas fa-coins"></i> –ë–∞–∑–æ–≤–∞—è —É–ª—É—á—à–µ–Ω–∏–µ</h3>
                         <span class="cost">15 –∫–æ–∏–Ω–æ–≤</span>
                         <span class="discount-badge">-50%</span>
                     </div>
                     <p>–ë–∞–∑–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∏–ª—è –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞</p>
                     <div class="free-enhancement-notice" id="free-notice" style="display: none;">
                         <i class="fas fa-gift"></i> <strong>–í–∞—à–µ –ø–µ—Ä–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ë–ï–°–ü–õ–ê–¢–ù–û!</strong>
                     </div>
                 </div>

                                 <!-- Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                 <div class="setting-card" id="markdown-setting">
                     <div class="setting-header">
                         <h3><i class="fas fa-code"></i> Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                         <label class="toggle-switch">
                             <input type="checkbox" id="use-markdown">
                             <span class="slider"></span>
                         </label>
                         <span class="cost">+15 –∫–æ–∏–Ω–æ–≤</span>
                         <span class="discount-badge">-50%</span>
                     </div>
                     <p>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏, –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏ —Ü–∏—Ç–∞—Ç—ã</p>
                                          <div class="preview-example" id="markdown-preview" style="display: none;">
                          <strong>–ü—Ä–∏–º–µ—Ä:</strong> <code>**–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç**</code>, <code># –ó–∞–≥–æ–ª–æ–≤–æ–∫</code>, <code>> —Ü–∏—Ç–∞—Ç–∞</code>
                      </div>
                 </div>

                                 <!-- –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å -->
                 <div class="setting-card" id="anonymity-setting">
                     <div class="setting-header">
                         <h3><i class="fas fa-user-secret"></i> –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å</h3>
                         <label class="toggle-switch">
                             <input type="checkbox" id="use-anonymity">
                             <span class="slider"></span>
                         </label>
                         <span class="cost">+15 –∫–æ–∏–Ω–æ–≤</span>
                         <span class="discount-badge">-50%</span>
                     </div>
                     <p>–°–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–º, –∏–∑–±–µ–≥–∞—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π</p>
                                          <div class="preview-example" id="anonymity-preview" style="display: none;">
                          <strong>–ü—Ä–∏–º–µ—Ä:</strong> "–û–¥–∏–Ω –∑–Ω–∞–∫–æ–º—ã–π" –≤–º–µ—Å—Ç–æ "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
                      </div>
                 </div>

                                 <!-- –≠–º–æ–¥–∑–∏ -->
                 <div class="setting-card" id="emojis-setting">
                     <div class="setting-header">
                         <h3><i class="fas fa-smile"></i> –î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏</h3>
                         <label class="toggle-switch">
                             <input type="checkbox" id="add-emojis">
                             <span class="slider"></span>
                         </label>
                         <span class="cost">+8 –∫–æ–∏–Ω–æ–≤</span>
                         <span class="discount-badge">-50%</span>
                     </div>
                     <p>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è —É–∫—Ä–∞—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞</p>
                                          <div class="preview-example" id="emojis-preview" style="display: none;">
                          <strong>–ü—Ä–∏–º–µ—Ä:</strong> üò± –û –Ω–µ—Ç! üéâ –ü—Ä–∞–∑–¥–Ω–∏–∫! üíî –†–∞–∑–±–∏—Ç–æ–µ —Å–µ—Ä–¥—Ü–µ
                      </div>
                 </div>

                <!-- –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å -->
                <div class="setting-card" id="creativity-setting">
                    <div class="setting-header">
                        <h3><i class="fas fa-lightbulb"></i> –£—Ä–æ–≤–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                        <span class="cost">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                    </div>
                    <div class="creativity-slider">
                        <input type="range" id="creativity-level" min="0.7" max="1.0" step="0.1" value="0.7">
                        <div class="slider-labels">
                            <span>–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ (0.7)</span>
                            <span>–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ (1.0)</span>
                        </div>
                        <div class="current-value">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: <span id="creativity-value">0.7</span></div>
                    </div>
                </div>

                <!-- –°—Ç–∏–ª—å -->
                <div class="setting-card" id="style-setting">
                    <div class="setting-header">
                        <h3><i class="fas fa-palette"></i> –°—Ç–∏–ª—å —É–ª—É—á—à–µ–Ω–∏—è</h3>
                        <span class="cost">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                    </div>
                    <select id="style-select" class="style-select">
                        <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                        <option value="formal">–§–æ—Ä–º–∞–ª—å–Ω—ã–π</option>
                        <option value="casual">–†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π</option>
                        <option value="dramatic">–î—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π</option>
                        <option value="humorous">–Æ–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π</option>
                        <option value="mysterious">–ó–∞–≥–∞–¥–æ—á–Ω—ã–π</option>
                    </select>
                    <div class="style-description" id="style-description">
                        –£–ª—É—á—à–∏ —Å—Ç–∏–ª—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è, —Å–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º –∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
        <div class="preview-section">
            <h2><i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —É–ª—É—á—à–µ–Ω–∏—è</h2>
            <div class="preview-card">
                <div class="preview-header">
                    <h3>{{ gossip.title }}</h3>
                    <div class="preview-meta">
                        <span><i class="fas fa-user"></i> {{ gossip.author.username }}</span>
                        <span><i class="fas fa-clock"></i> {{ gossip.date_posted.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                </div>
                <div class="preview-content" id="preview-content">
                    <p class="preview-placeholder">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—à–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —É–ª—É—á—à–µ–Ω–∏—è</p>
                </div>
            </div>
        </div>

        <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å -->
        <div class="cost-summary">
            <div class="cost-breakdown">
                <h3><i class="fas fa-calculator"></i> –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</h3>
                <div class="cost-items">
                                         <div class="cost-item">
                         <span>–ë–∞–∑–æ–≤–∞—è —É–ª—É—á—à–µ–Ω–∏–µ:</span>
                         <span>15 –∫–æ–∏–Ω–æ–≤</span>
                     </div>
                                         <div class="cost-item" id="markdown-cost" style="display: none;">
                         <span>Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</span>
                         <span>+15 –∫–æ–∏–Ω–æ–≤</span>
                     </div>
                                         <div class="cost-item" id="anonymity-cost" style="display: none;">
                         <span>–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å:</span>
                         <span>+15 –∫–æ–∏–Ω–æ–≤</span>
                     </div>
                                         <div class="cost-item" id="emojis-cost" style="display: none;">
                         <span>–≠–º–æ–¥–∑–∏:</span>
                         <span>+8 –∫–æ–∏–Ω–æ–≤</span>
                     </div>
                                         <div class="cost-item total">
                         <span><strong>–ò—Ç–æ–≥–æ:</strong></span>
                         <span><strong id="total-cost">15</strong> –∫–æ–∏–Ω–æ–≤</span>
                     </div>
                                           <div class="cost-item discount" id="discount-item" style="display: none;">
                          <span><strong id="discount-label">–°–∫–∏–¥–∫–∞:</strong></span>
                          <span><strong id="discount-amount">-0</strong></span>
                      </div>
                     <div class="cost-item final" id="final-cost-item">
                         <span><strong>–ö –æ–ø–ª–∞—Ç–µ:</strong></span>
                         <span><strong id="final-cost">15</strong> –∫–æ–∏–Ω–æ–≤</span>
                     </div>
                </div>
            </div>
            
            <div class="user-balance">
                <p>–í–∞—à –±–∞–ª–∞–Ω—Å: <span class="coins-amount">{{ user_coins }}</span> –∫–æ–∏–Ω–æ–≤</p>
                <div class="balance-status" id="balance-status">
                    <i class="fas fa-check-circle"></i> –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="action-buttons">
            <a href="{{ url_for('gossip', gossip_id=gossip.id) }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–ª–µ—Ç–Ω–µ
            </a>
                         <button type="button" class="btn btn-primary" id="enhance-btn" onclick="enhanceGossip()">
                 <i class="fas fa-magic"></i> –£–ª—É—á—à–∏—Ç—å —Å–ø–ª–µ—Ç–Ω—é (<span id="enhance-cost">15</span> –∫–æ–∏–Ω–æ–≤)
             </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const useMarkdown = document.getElementById('use-markdown');
    const useAnonymity = document.getElementById('use-anonymity');
    const addEmojis = document.getElementById('add-emojis');
    const creativityLevel = document.getElementById('creativity-level');
    const creativityValue = document.getElementById('creativity-value');
    const styleSelect = document.getElementById('style-select');
    const styleDescription = document.getElementById('style-description');
    const enhanceBtn = document.getElementById('enhance-btn');
    const enhanceCost = document.getElementById('enhance-cost');
    const totalCost = document.getElementById('total-cost');
    const balanceStatus = document.getElementById('balance-status');
    const userCoins = parseInt('{{ user_coins }}');

    // –°—Ç–∏–ª–∏ –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è
    const styleDescriptions = {
        'default': '–£–ª—É—á—à–∏ —Å—Ç–∏–ª—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è, —Å–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º –∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º',
        'formal': '–°–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º',
        'casual': '–°–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º',
        'dramatic': '–î–æ–±–∞–≤—å –¥—Ä–∞–º–∞—Ç–∏–∑–º–∞ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏',
        'humorous': '–î–æ–±–∞–≤—å —é–º–æ—Ä–∞ –∏ –∑–∞–±–∞–≤–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤',
        'mysterious': '–°–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –∑–∞–≥–∞–¥–æ—á–Ω—ã–º –∏ –∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–º'
    };

         // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏
     function updateCost() {
         let cost = 15; // –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–ø–æ–≤—ã—à–µ–Ω–∞ –Ω–∞ 50%)
         
         if (useMarkdown.checked) cost += 15;
         if (useAnonymity.checked) cost += 15;
         if (addEmojis.checked) cost += 8;
         
         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
         const hasUsedFree = '{{ current_user.has_used_free_enhancement if current_user.is_authenticated else False }}' === 'True';
         
         let finalCost = cost;
         let discountAmount = 0;
         
                   if (!hasUsedFree) {
              // –ü–µ—Ä–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
              finalCost = 0;
              discountAmount = cost; // 100% —Å–∫–∏–¥–∫–∞
              document.getElementById('free-notice').style.display = 'block';
          } else {
              // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É 50%
              discountAmount = Math.floor(cost / 2);
              finalCost = cost - discountAmount;
              document.getElementById('free-notice').style.display = 'none';
          }
         
         totalCost.textContent = cost;
         enhanceCost.textContent = finalCost;
         
         // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏
         const discountItem = document.getElementById('discount-item');
         const discountAmountEl = document.getElementById('discount-amount');
         const finalCostEl = document.getElementById('final-cost');
         
                   if (discountAmount > 0) {
              discountItem.style.display = 'flex';
              const discountLabel = document.getElementById('discount-label');
              if (!hasUsedFree) {
                  // –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 100% —Å–∫–∏–¥–∫—É
                  discountLabel.textContent = '–°–∫–∏–¥–∫–∞ 100%:';
                  discountAmountEl.textContent = `-${discountAmount} –∫–æ–∏–Ω–æ–≤`;
              } else {
                  // –î–ª—è –æ–±—ã—á–Ω–æ–π —Å–∫–∏–¥–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 50%
                  discountLabel.textContent = '–°–∫–∏–¥–∫–∞ 50%:';
                  discountAmountEl.textContent = `-${discountAmount} –∫–æ–∏–Ω–æ–≤`;
              }
          } else {
              discountItem.style.display = 'none';
          }
         
         finalCostEl.textContent = finalCost;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        document.getElementById('markdown-cost').style.display = useMarkdown.checked ? 'flex' : 'none';
        document.getElementById('anonymity-cost').style.display = useAnonymity.checked ? 'flex' : 'none';
        document.getElementById('emojis-cost').style.display = addEmojis.checked ? 'flex' : 'none';
        
                 // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å)
         if (finalCost <= userCoins) {
             balanceStatus.innerHTML = '<i class="fas fa-check-circle"></i> –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤';
             balanceStatus.className = 'balance-status sufficient';
             enhanceBtn.disabled = false;
         } else {
             balanceStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–∏–Ω–æ–≤';
             balanceStatus.className = 'balance-status insufficient';
             enhanceBtn.disabled = true;
         }
    }

    // –ü—Ä–∏–º–µ—Ä —Å–ø–ª–µ—Ç–Ω–∏ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    const sampleGossip = {
        original: "–°–µ–≥–æ–¥–Ω—è –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ü–µ–Ω—Ç—Ä–µ —è —É–≤–∏–¥–µ–ª–∞ —Å–≤–æ—é –ø–æ–¥—Ä—É–≥—É –ê–Ω–Ω—É. –û–Ω–∞ –±—ã–ª–∞ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–Ω–µ–º –∏ –æ–Ω–∏ –æ—á–µ–Ω—å –º–∏–ª–æ –æ–±—â–∞–ª–∏—Å—å. –Ø –±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞ –ø–æ—Ç–æ–º—É —á—Ç–æ –ê–Ω–Ω–∞ –≤—Å–µ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–ª–∞ —á—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –Ø –±—ã—Å—Ç—Ä–æ —É—à–ª–∞ –∏ –≤–µ—Å—å –≤–µ—á–µ—Ä –¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º –¥–æ–º–∞. –ú–æ—è —Å–µ—Å—Ç—Ä–∞ –ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–ª–æ."
    };

    // –§—É–Ω–∫—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    function applyBasicEnhancement(text) {
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø—ã –∏ —É–ª—É—á—à–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        let enhanced = text;
        
        // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø—ã
        enhanced = enhanced.replace(/\. /g, '.\n\n');
        enhanced = enhanced.replace(/! /g, '!\n\n');
        enhanced = enhanced.replace(/\? /g, '?\n\n');
        
        // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
        enhanced = enhanced.replace(/\n\n\n+/g, '\n\n');
        
        return enhanced;
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª—è
    function applyStyle(text, style) {
        switch(style) {
            case 'formal':
                return text
                    .replace(/—è —É–≤–∏–¥–µ–ª–∞/g, '—è –∑–∞–º–µ—Ç–∏–ª–∞')
                    .replace(/–±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞/g, '–∏—Å–ø—ã—Ç–∞–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∏–µ')
                    .replace(/–±—ã—Å—Ç—Ä–æ —É—à–ª–∞/g, '–Ω–µ–∑–∞–º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∏–Ω—É–ª–∞ –º–µ—Å—Ç–æ')
                    .replace(/–¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º/g, '—Ä–∞–∑–º—ã—à–ª—è–ª–∞ –Ω–∞–¥ —É–≤–∏–¥–µ–Ω–Ω—ã–º')
                    .replace(/–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å/g, '–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞–ª–∞ –ø–æ–ø—ã—Ç–∫–∏ —É—Ç–µ—à–∏—Ç—å –º–µ–Ω—è');
            case 'casual':
                return text
                    .replace(/—è —É–≤–∏–¥–µ–ª–∞/g, '—è –∑–∞–º–µ—Ç–∏–ª–∞')
                    .replace(/–±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞/g, '–±—ã–ª–∞ –≤ —à–æ–∫–µ')
                    .replace(/–±—ã—Å—Ç—Ä–æ —É—à–ª–∞/g, '–±—ã—Å—Ç—Ä–æ —É—à–ª–∞')
                    .replace(/–¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º/g, '–¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º')
                    .replace(/–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å/g, '–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å');
            case 'dramatic':
                return text
                    .replace(/—è —É–≤–∏–¥–µ–ª–∞/g, '—è —Å—Ç–∞–ª–∞ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–º –¥—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ü–µ–Ω—ã')
                    .replace(/–±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞/g, '–±—ã–ª–∞ –≤ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º —à–æ–∫–µ')
                    .replace(/–±—ã—Å—Ç—Ä–æ —É—à–ª–∞/g, '—Å —Ä–∞–∑–±–∏—Ç—ã–º —Å–µ—Ä–¥—Ü–µ–º –ø–æ–∫–∏–Ω—É–ª–∞ –º–µ—Å—Ç–æ')
                    .replace(/–¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º/g, '–Ω–µ –º–æ–≥–ª–∞ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –¥—É–º–∞—Ç—å –æ–± —É–≤–∏–¥–µ–Ω–Ω–æ–º')
                    .replace(/–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å/g, '–æ—Ç—á–∞—è–Ω–Ω–æ –ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å');
            case 'humorous':
                return text
                    .replace(/—è —É–≤–∏–¥–µ–ª–∞/g, '—è —Å–ª—É—á–∞–π–Ω–æ –ø–æ–¥–≥–ª—è–¥–µ–ª–∞')
                    .replace(/–±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞/g, '–±—ã–ª–∞ –≤ –ª–µ–≥–∫–æ–º —à–æ–∫–µ')
                    .replace(/–±—ã—Å—Ç—Ä–æ —É—à–ª–∞/g, '–±—ã—Å—Ç—Ä–æ —Ä–µ—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å')
                    .replace(/–¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º/g, '–æ–±–¥—É–º—ã–≤–∞–ª–∞ —ç—Ç—É —Å–∏—Ç—É–∞—Ü–∏—é')
                    .replace(/–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å/g, '–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —Ä–∞–∑–≤–µ—Å–µ–ª–∏—Ç—å');
            case 'mysterious':
                return text
                    .replace(/—è —É–≤–∏–¥–µ–ª–∞/g, '—è –∑–∞–º–µ—Ç–∏–ª–∞ —á—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ')
                    .replace(/–±—ã–ª–∞ —É–¥–∏–≤–ª–µ–Ω–∞/g, '–ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å—Ç—Ä–∞–Ω–Ω–æ–µ –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ')
                    .replace(/–±—ã—Å—Ç—Ä–æ —É—à–ª–∞/g, '—Ç–∏—Ö–æ —É—à–ª–∞')
                    .replace(/–¥—É–º–∞–ª–∞ –æ–± —ç—Ç–æ–º/g, '—Ä–∞–∑–º—ã—à–ª—è–ª–∞ –Ω–∞–¥ –∑–∞–≥–∞–¥–∫–æ–π')
                    .replace(/–ø—ã—Ç–∞–ª–∞—Å—å –º–µ–Ω—è —É—Ç–µ—à–∏—Ç—å/g, '–ø—ã—Ç–∞–ª–∞—Å—å —Ä–∞–∑–≥–∞–¥–∞—Ç—å —ç—Ç—É —Ç–∞–π–Ω—É');
            default:
                return text;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Markdown
    function applyMarkdown(text) {
        let enhanced = text;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫ –ø–µ—Ä–≤–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é
        enhanced = enhanced.replace(/^(–°–µ–≥–æ–¥–Ω—è –≤ —Ç–æ—Ä–≥–æ–≤–æ–º —Ü–µ–Ω—Ç—Ä–µ.*?\.)/, '## $1');
        
        // –í—ã–¥–µ–ª—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        enhanced = enhanced.replace(/(–ø–æ–¥—Ä—É–≥–∞ –ê–Ω–Ω–∞)/g, '**$1**');
        enhanced = enhanced.replace(/(–Ω–æ–≤—ã–π –ø–∞—Ä–µ–Ω—å)/g, '**$1**');
        enhanced = enhanced.replace(/(—Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π)/g, '**$1**');
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ç–∞—Ç—É
        enhanced = enhanced.replace(/(–ê–Ω–Ω–∞ –≤—Å–µ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏–ª–∞ —á—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π)/g, '> $1');
        
        return enhanced;
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏
    function applyAnonymity(text) {
        return text
            .replace(/–ê–Ω–Ω–∞/g, '–æ–¥–Ω–∞ –¥–µ–≤—É—à–∫–∞')
            .replace(/–º–æ—è –ø–æ–¥—Ä—É–≥–∞/g, '–æ–¥–Ω–∞ –∑–Ω–∞–∫–æ–º–∞—è')
            .replace(/–Ω–æ–≤—ã–π –ø–∞—Ä–µ–Ω—å/g, '–Ω–µ–∑–Ω–∞–∫–æ–º—ã–π –º—É–∂—á–∏–Ω–∞')
            .replace(/–º–æ—è —Å–µ—Å—Ç—Ä–∞/g, '–º–æ—è —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏—Ü–∞');
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç–º–æ–¥–∑–∏
    function applyEmojis(text) {
        return text
            .replace(/—É–≤–∏–¥–µ–ª–∞/g, '—É–≤–∏–¥–µ–ª–∞ üëÄ')
            .replace(/—É–¥–∏–≤–∏–ª–∞—Å—å/g, '—É–¥–∏–≤–∏–ª–∞—Å—å üò±')
            .replace(/—à–æ–∫–µ/g, '—à–æ–∫–µ üò§')
            .replace(/—É—à–ª–∞/g, '—É—à–ª–∞ üíî')
            .replace(/–¥—É–º–∞–ª–∞/g, '–¥—É–º–∞–ª–∞ üò¢')
            .replace(/—É—Ç–µ—à–∏—Ç—å/g, '—É—Ç–µ—à–∏—Ç—å ü§ó')
            .replace(/–ø–æ–¥—Ä—É–≥–∞/g, '–ø–æ–¥—Ä—É–≥–∞ üë≠')
            .replace(/–ø–∞—Ä–µ–Ω—å/g, '–ø–∞—Ä–µ–Ω—å üíë');
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function updatePreview() {
        const previewContent = document.getElementById('preview-content');
        let changes = [];
        let enhancedText = sampleGossip.original;
        
        // 1. –í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
        enhancedText = applyBasicEnhancement(enhancedText);
        changes.push('‚ú® <strong>–ë–∞–∑–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ</strong> –ø—Ä–∏–º–µ–Ω–µ–Ω–æ');
        
        // 2. –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
        const style = styleSelect.value;
        if (style !== 'default') {
            enhancedText = applyStyle(enhancedText, style);
            changes.push('üé® <strong>–°—Ç–∏–ª—å "' + styleSelect.options[styleSelect.selectedIndex].text + '"</strong> –ø—Ä–∏–º–µ–Ω–µ–Ω');
        }
        
        // 3. –ü—Ä–∏–º–µ–Ω—è–µ–º Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
        if (useMarkdown.checked) {
            enhancedText = applyMarkdown(enhancedText);
            changes.push('üìù <strong>Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</strong> –¥–æ–±–∞–≤–ª–µ–Ω–æ');
        }
        
        // 4. –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
        if (useAnonymity.checked) {
            enhancedText = applyAnonymity(enhancedText);
            changes.push('üïµÔ∏è <strong>–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å</strong> –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');
        }
        
        // 5. –ü—Ä–∏–º–µ–Ω—è–µ–º —ç–º–æ–¥–∑–∏ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
        if (addEmojis.checked) {
            enhancedText = applyEmojis(enhancedText);
            changes.push('üòä <strong>–≠–º–æ–¥–∑–∏</strong> –¥–æ–±–∞–≤–ª–µ–Ω—ã');
        }
        
        // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        let previewHTML = '<div class="preview-demo">';
        
        if (changes.length > 0) {
            previewHTML += '<div class="preview-changes">';
            previewHTML += '<p><strong>–ë—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:</strong></p>';
            previewHTML += '<ul>' + changes.map(change => '<li>' + change + '</li>').join('') + '</ul>';
            previewHTML += '</div>';
        }
        
        previewHTML += '<div class="before-after-demo">';
        previewHTML += '<div class="before-section">';
        previewHTML += '<h4><i class="fas fa-file-alt"></i> –î–æ —É–ª—É—á—à–µ–Ω–∏—è:</h4>';
        previewHTML += '<div class="text-sample original">' + sampleGossip.original + '</div>';
        previewHTML += '</div>';
        
        previewHTML += '<div class="after-section">';
        previewHTML += '<h4><i class="fas fa-magic"></i> –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:</h4>';
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ Markdown –≤ HTML
        function renderMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/## (.*?)(\n|$)/g, '<h3>$1</h3>')
                .replace(/> (.*?)(\n|$)/g, '<blockquote>$1</blockquote>')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');
        }
        
        previewHTML += '<div class="text-sample enhanced">' + renderMarkdown(enhancedText) + '</div>';
        previewHTML += '</div>';
        previewHTML += '</div>';
        
        previewHTML += '<div class="preview-note">';
        previewHTML += '<p><em>üí° –≠—Ç–æ –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–ª–∏—è—é—Ç –Ω–∞ –≤–∞—à—É —Å–ø–ª–µ—Ç–Ω—é</em></p>';
        previewHTML += '</div>';
        
        previewHTML += '</div>';
        
        previewContent.innerHTML = previewHTML;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    useMarkdown.addEventListener('change', function() {
        document.getElementById('markdown-preview').style.display = this.checked ? 'block' : 'none';
        updateCost();
        updatePreview();
    });

    useAnonymity.addEventListener('change', function() {
        document.getElementById('anonymity-preview').style.display = this.checked ? 'block' : 'none';
        updateCost();
        updatePreview();
    });

    addEmojis.addEventListener('change', function() {
        document.getElementById('emojis-preview').style.display = this.checked ? 'block' : 'none';
        updateCost();
        updatePreview();
    });

    creativityLevel.addEventListener('input', function() {
        creativityValue.textContent = this.value;
    });

    styleSelect.addEventListener('change', function() {
        styleDescription.textContent = styleDescriptions[this.value] || styleDescriptions['default'];
        updatePreview();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateCost();
    updatePreview();
});

// –§—É–Ω–∫—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏—è —Å–ø–ª–µ—Ç–Ω–∏
function enhanceGossip() {
    const enhanceBtn = document.getElementById('enhance-btn');
    const originalText = enhanceBtn.innerHTML;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    enhanceBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –£–ª—É—á—à–∞–µ–º...';
    enhanceBtn.disabled = true;
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const settings = {
        use_markdown: document.getElementById('use-markdown').checked,
        use_anonymity: document.getElementById('use-anonymity').checked,
        add_emojis: document.getElementById('add-emojis').checked,
        creativity_level: parseFloat(document.getElementById('creativity-level').value),
        style: document.getElementById('style-select').value
    };
    
    // –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    fetch(`/gossip/{{ gossip.id }}/enhance_ai_advanced`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // –ù–∞—á–∏–Ω–∞–µ–º —Å—Ç—Ä–∏–º–∏–Ω–≥
            startStreaming(data.stream_url);
        } else {
            showNotification(data.message, 'error');
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            enhanceBtn.innerHTML = originalText;
            enhanceBtn.disabled = false;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏ —Å–ø–ª–µ—Ç–Ω–∏', 'error');
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        enhanceBtn.innerHTML = originalText;
        enhanceBtn.disabled = false;
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function startStreaming(streamUrl) {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
    const modal = document.createElement('div');
    modal.className = 'streaming-modal';
    modal.innerHTML = `
        <div class="streaming-content">
            <div class="streaming-header">
                <h3><i class="fas fa-magic"></i> –£–ª—É—á—à–µ–Ω–∏–µ —Å–ø–ª–µ—Ç–Ω–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h3>
                <div class="streaming-status" id="streaming-status">
                    <i class="fas fa-spinner fa-spin"></i> –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...
                </div>
            </div>
            <div class="streaming-body">
                <div class="streaming-text" id="streaming-text">
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
            <div class="streaming-footer">
                <button class="btn btn-secondary" onclick="closeStreamingModal()">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å—Ç—Ä–∏–º—É
    const eventSource = new EventSource(streamUrl);
    let fullText = '';
    let isCompleted = false;
    
    eventSource.onmessage = function(event) {
        const data = JSON.parse(event.data);
        console.log('–ü–æ–ª—É—á–µ–Ω–æ SSE —Å–æ–æ–±—â–µ–Ω–∏–µ:', data);
        
        switch(data.type) {
            case 'start':
                updateStreamingStatus('–ù–∞—á–∏–Ω–∞–µ–º —É–ª—É—á—à–µ–Ω–∏–µ —Å–ø–ª–µ—Ç–Ω–∏...', 'info');
                break;
                
            case 'ai_start':
                updateStreamingStatus('AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å...', 'processing');
                break;
                
            case 'chunk':
                fullText += data.content;
                updateStreamingText(fullText);
                break;
                
            case 'complete':
                console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ complete:', data);
                isCompleted = true;
                eventSource.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                updateStreamingStatus('–°–ø–ª–µ—Ç–Ω—è —É—Å–ø–µ—à–Ω–æ —É–ª—É—á—à–µ–Ω–∞!', 'success');
                showApplyCancelButtons(data.redirect, data.total_cost);
                break;
                
            case 'error':
                isCompleted = true;
                eventSource.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                updateStreamingStatus(data.message, 'error');
                setTimeout(() => {
                    closeStreamingModal();
                }, 3000);
                break;
        }
    };
    
    eventSource.onerror = function(event) {
        if (!isCompleted) { // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
            updateStreamingStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å—Ç—Ä–∏–º—É', 'error');
            setTimeout(() => {
                closeStreamingModal();
            }, 3000);
        }
    };
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
function updateStreamingStatus(message, type) {
    const statusElement = document.getElementById('streaming-status');
    if (statusElement) {
        const icon = type === 'success' ? 'check-circle' : 
                    type === 'error' ? 'exclamation-triangle' : 
                    type === 'processing' ? 'spinner fa-spin' : 'info-circle';
        
        statusElement.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
        statusElement.className = `streaming-status ${type}`;
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
function updateStreamingText(text) {
    const textElement = document.getElementById('streaming-text');
    if (textElement) {
        // –ü—Ä–æ—Å—Ç–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Markdown
        const renderedText = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/## (.*?)(\n|$)/g, '<h3>$1</h3>')
            .replace(/> (.*?)(\n|$)/g, '<blockquote>$1</blockquote>')
            .replace(/\n\n/g, '<br><br>')
            .replace(/\n/g, '<br>');
        
        textElement.innerHTML = renderedText;
        textElement.scrollTop = textElement.scrollHeight;
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∫–Ω–æ–ø–æ–∫ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" –∏ "–û—Ç–º–µ–Ω–∞"
function showApplyCancelButtons(redirectUrl, totalCost) {
    console.log('showApplyCancelButtons –≤—ã–∑–≤–∞–Ω–∞:', { redirectUrl, totalCost });
    const footer = document.querySelector('.streaming-footer');
    console.log('Footer –Ω–∞–π–¥–µ–Ω:', footer);
    
    if (footer) {
        const refundAmount = Math.floor(totalCost * 0.75);
        console.log('Refund amount:', refundAmount);
        
        footer.innerHTML = `
            <div class="apply-cancel-buttons">
                <button class="btn btn-success" onclick="applyEnhancement('${redirectUrl}')">
                    <i class="fas fa-check"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ
                </button>
                <button class="btn btn-warning" onclick="cancelEnhancement(${refundAmount})">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞ (–≤–æ–∑–≤—Ä–∞—Ç ${refundAmount} –∫–æ–∏–Ω–æ–≤)
                </button>
            </div>
        `;
        console.log('–ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ footer');
    } else {
        console.error('Footer –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏—è
function applyEnhancement(redirectUrl) {
    updateStreamingStatus('–ü—Ä–∏–º–µ–Ω—è–µ–º —É–ª—É—á—à–µ–Ω–∏–µ...', 'processing');
    setTimeout(() => {
        window.location.href = redirectUrl;
    }, 1000);
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è
function cancelEnhancement(refundAmount) {
    const gossipId = '{{ gossip.id }}';
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    updateStreamingStatus('–û—Ç–º–µ–Ω—è–µ–º —É–ª—É—á—à–µ–Ω–∏–µ...', 'processing');
    
    fetch(`/gossip/${gossipId}/cancel_enhancement`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            updateStreamingStatus(`–£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ! –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${refundAmount} –∫–æ–∏–Ω–æ–≤`, 'success');
            setTimeout(() => {
                window.location.href = `/gossip/${gossipId}`;
            }, 2000);
        } else {
            updateStreamingStatus(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        updateStreamingStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É–ª—É—á—à–µ–Ω–∏—è', 'error');
    });
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
function closeStreamingModal() {
    const modal = document.querySelector('.streaming-modal');
    if (modal) {
        modal.remove();
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
    `;
    
    if (type === 'success') {
        notification.style.backgroundColor = '#28a745';
    } else if (type === 'error') {
        notification.style.backgroundColor = '#dc3545';
    }
    
    document.body.appendChild(notification);
    
    // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}
</script>

<style>
/* CSS Variables for Dark Theme */
:root {
    --bg-color: #0d1117;
    --card-bg: rgba(22, 27, 34, 0.75);
    --text-color: #c9d1d9;
    --text-muted: #8b949e;
    --border-color: rgba(139, 148, 158, 0.2);
    --accent-color: #58a6ff;
    --accent-secondary: #9370db;
    --accent-gradient: linear-gradient(120deg, #58a6ff, #9370db);
    --success-color: #2ea043;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.enhance-ai-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: var(--bg-color);
    min-height: 100vh;
}

.enhance-ai-header {
    text-align: center;
    margin-bottom: 30px;
    padding: 20px;
    background: var(--accent-gradient);
    border-radius: 15px;
    color: white;
    box-shadow: 0 8px 32px rgba(88, 166, 255, 0.3);
}

.enhance-ai-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: 700;
}

.enhance-ai-header .subtitle {
    margin: 10px 0 0 0;
    font-size: 1.1rem;
    opacity: 0.9;
}

.enhance-ai-content {
    display: grid;
    gap: 30px;
}

/* –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å–ø–ª–µ—Ç–Ω—è */
.original-gossip-section {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
}

.original-gossip-section h2 {
    margin: 0 0 20px 0;
    color: var(--text-color);
    font-size: 1.5rem;
}

.gossip-card.original {
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    background: var(--bg-color);
}

.gossip-card.original h3 {
    margin: 0 0 15px 0;
    color: var(--text-color);
    font-size: 1.3rem;
}

.gossip-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    font-size: 0.9rem;
    color: var(--text-muted);
}

.gossip-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.gossip-content {
    line-height: 1.6;
    color: var(--text-color);
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è */
.enhancement-settings {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
}

.enhancement-settings h2 {
    margin: 0 0 25px 0;
    color: var(--text-color);
    font-size: 1.5rem;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}

.setting-card {
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    background: var(--bg-color);
    transition: all 0.3s ease;
}

.setting-card:hover {
    border-color: var(--accent-color);
    box-shadow: 0 4px 15px rgba(88, 166, 255, 0.3);
    transform: translateY(-2px);
}

.setting-card.base-cost {
    border-color: var(--success-color);
    background: linear-gradient(135deg, rgba(46, 160, 67, 0.1), rgba(46, 160, 67, 0.05));
}

.setting-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 10px;
}

.setting-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 8px;
}

 .cost {
     background: var(--accent-color);
     color: white;
     padding: 4px 8px;
     border-radius: 15px;
     font-size: 0.8rem;
     font-weight: 600;
 }

 .discount-badge {
     background: linear-gradient(135deg, #28a745, #20c997);
     color: white;
     padding: 2px 6px;
     border-radius: 10px;
     font-size: 0.7rem;
     font-weight: 700;
     margin-left: 5px;
 }

 .free-enhancement-notice {
     margin-top: 10px;
     padding: 8px 12px;
     background: linear-gradient(135deg, #ff6b6b, #ee5a24);
     color: white;
     border-radius: 8px;
     font-size: 0.9rem;
     text-align: center;
     animation: pulse 2s infinite;
 }

 @keyframes pulse {
     0% { transform: scale(1); }
     50% { transform: scale(1.05); }
     100% { transform: scale(1); }
 }

.setting-card p {
    margin: 0;
    color: var(--text-muted);
    font-size: 0.9rem;
    line-height: 1.4;
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--accent-color);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

/* Creativity Slider */
.creativity-slider {
    margin-top: 15px;
}

.creativity-slider input[type="range"] {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: #ddd;
    outline: none;
    -webkit-appearance: none;
}

.creativity-slider input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent-color);
    cursor: pointer;
}

.creativity-slider input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent-color);
    cursor: pointer;
    border: none;
}

.slider-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.current-value {
    text-align: center;
    margin-top: 8px;
    font-size: 0.9rem;
    color: var(--text-color);
    font-weight: 600;
}

/* Style Select */
.style-select {
    width: 100%;
    padding: 10px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: var(--bg-color);
    color: var(--text-color);
    font-size: 0.9rem;
    margin-top: 10px;
}

.style-description {
    margin-top: 10px;
    font-size: 0.8rem;
    color: var(--text-muted);
    font-style: italic;
}

/* Preview Examples */
.preview-example {
    margin-top: 10px;
    padding: 10px;
    background: rgba(88, 166, 255, 0.1);
    border-radius: 5px;
    font-size: 0.8rem;
}

.preview-example strong {
    color: var(--accent-color);
}



/* –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä */
.preview-section {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
}

.preview-section h2 {
    margin: 0 0 20px 0;
    color: var(--text-color);
    font-size: 1.5rem;
}

.preview-card {
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    background: var(--bg-color);
}

.preview-header h3 {
    margin: 0 0 15px 0;
    color: var(--text-color);
    font-size: 1.3rem;
}

.preview-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    font-size: 0.9rem;
    color: var(--text-muted);
}

.preview-content {
    line-height: 1.6;
    color: var(--text-color);
}

.preview-placeholder {
    color: var(--text-muted);
    font-style: italic;
    text-align: center;
    padding: 20px;
}

.preview-changes ul {
    margin: 10px 0;
    padding-left: 20px;
}

.preview-changes li {
    margin-bottom: 5px;
}

.preview-basic {
    text-align: center;
    padding: 20px;
}

/* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
.preview-demo {
    padding: 20px 0;
}

.before-after-demo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
}

.before-section, .after-section {
    background: var(--bg-color);
    border: 2px solid var(--border-color);
    border-radius: 10px;
    padding: 15px;
    transition: all 0.3s ease;
}

.before-section:hover, .after-section:hover {
    border-color: var(--accent-color);
    box-shadow: 0 4px 15px rgba(88, 166, 255, 0.2);
}

.before-section h4, .after-section h4 {
    margin: 0 0 15px 0;
    color: var(--text-color);
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.before-section h4 {
    color: var(--text-muted);
}

.after-section h4 {
    color: var(--accent-color);
}

.text-sample {
    line-height: 1.6;
    font-size: 0.9rem;
    padding: 10px;
    border-radius: 5px;
    background: rgba(139, 148, 158, 0.05);
    border-left: 3px solid var(--border-color);
}

.text-sample.original {
    color: var(--text-muted);
    border-left-color: var(--text-muted);
}

.text-sample.enhanced {
    color: var(--text-color);
    border-left-color: var(--accent-color);
}

.text-sample.enhanced h3 {
    margin: 0 0 15px 0;
    color: var(--accent-color);
    font-size: 1.2rem;
    font-weight: 600;
}

.text-sample.enhanced blockquote {
    margin: 15px 0;
    padding: 10px 15px;
    background: rgba(88, 166, 255, 0.1);
    border-left: 3px solid var(--accent-color);
    border-radius: 5px;
    font-style: italic;
}

.text-sample.enhanced strong {
    color: var(--accent-color);
    font-weight: 600;
}

.text-sample.enhanced em {
    font-style: italic;
    color: var(--text-muted);
}

.preview-note {
    text-align: center;
    margin-top: 20px;
    padding: 15px;
    background: rgba(88, 166, 255, 0.1);
    border-radius: 8px;
    border: 1px solid rgba(88, 166, 255, 0.2);
}

.preview-note p {
    margin: 0;
    color: var(--text-muted);
    font-size: 0.9rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
@media (max-width: 768px) {
    .before-after-demo {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .before-section, .after-section {
        padding: 12px;
    }
    
    .text-sample {
        font-size: 0.85rem;
    }
}

/* –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å */
.cost-summary {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 30px;
    align-items: start;
}

.cost-breakdown h3 {
    margin: 0 0 20px 0;
    color: var(--text-color);
    font-size: 1.3rem;
}

.cost-items {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.cost-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-color);
}

 .cost-item.total {
     border-top: 2px solid var(--accent-color);
     border-bottom: none;
     padding-top: 15px;
     font-size: 1.1rem;
 }

 .cost-item.discount {
     border-top: 1px solid #28a745;
     border-bottom: none;
     padding-top: 10px;
     font-size: 1rem;
     color: #28a745;
 }

 .cost-item.final {
     border-top: 2px solid #28a745;
     border-bottom: none;
     padding-top: 15px;
     font-size: 1.2rem;
     color: #28a745;
     background: rgba(40, 167, 69, 0.1);
     border-radius: 8px;
     margin-top: 10px;
 }

.user-balance {
    text-align: center;
    padding: 20px;
    background: var(--bg-color);
    border-radius: 10px;
    border: 2px solid var(--border-color);
}

.user-balance p {
    margin: 0 0 10px 0;
    font-size: 1.1rem;
    color: var(--text-color);
}

.coins-amount {
    color: var(--accent-color);
    font-weight: 700;
    font-size: 1.2rem;
}

.balance-status {
    font-size: 0.9rem;
    font-weight: 600;
}

.balance-status.sufficient {
    color: #28a745;
}

.balance-status.insufficient {
    color: #dc3545;
}

/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.action-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
}

.action-buttons .btn {
    padding: 12px 25px;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-secondary {
    background: #6c757d;
    color: white;
    border: none;
}

.btn-secondary:hover {
    background: #5a6268;
    color: white;
}

.btn-primary {
    background: var(--accent-gradient);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(88, 166, 255, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(88, 166, 255, 0.4);
}

.btn-primary:disabled {
    background: #ccc;
    transform: none;
    box-shadow: none;
    cursor: not-allowed;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ */
.streaming-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease-out;
}

.streaming-content {
    background: var(--card-bg);
    border-radius: 15px;
    padding: 0;
    max-width: 800px;
    width: 90%;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border-color);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.streaming-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    background: var(--accent-gradient);
    border-radius: 15px 15px 0 0;
    color: white;
}

.streaming-header h3 {
    margin: 0 0 10px 0;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.streaming-status {
    font-size: 0.9rem;
    opacity: 0.9;
    display: flex;
    align-items: center;
    gap: 8px;
}

.streaming-status.info {
    color: #58a6ff;
}

.streaming-status.processing {
    color: #f0b400;
}

.streaming-status.success {
    color: #2ea043;
}

.streaming-status.error {
    color: #f85149;
}

.streaming-body {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    min-height: 300px;
}

.streaming-text {
    line-height: 1.6;
    color: var(--text-color);
    font-size: 1rem;
    white-space: pre-wrap;
    word-wrap: break-word;
}

.streaming-text h3 {
    color: var(--accent-color);
    margin: 15px 0 10px 0;
    font-size: 1.2rem;
}

.streaming-text blockquote {
    margin: 15px 0;
    padding: 10px 15px;
    background: rgba(88, 166, 255, 0.1);
    border-left: 3px solid var(--accent-color);
    border-radius: 5px;
    font-style: italic;
}

.streaming-text strong {
    color: var(--accent-color);
    font-weight: 600;
}

.streaming-text em {
    font-style: italic;
    color: var(--text-muted);
}

.streaming-footer {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: center;
}

.apply-cancel-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.apply-cancel-buttons .btn {
    padding: 12px 20px;
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    min-width: 180px;
    justify-content: center;
}

.btn-success {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

.btn-warning {
    background: linear-gradient(135deg, #ffc107, #fd7e14);
    color: white;
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
}

.btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ */
.typing-indicator {
    display: flex;
    gap: 4px;
    justify-content: center;
    padding: 20px;
}

.typing-indicator span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-color);
    animation: typing 1.4s infinite ease-in-out;
}

.typing-indicator span:nth-child(1) {
    animation-delay: -0.32s;
}

.typing-indicator span:nth-child(2) {
    animation-delay: -0.16s;
}

@keyframes typing {
    0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
    }
    40% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .enhance-ai-container {
        padding: 10px;
    }
    
    .enhance-ai-header h1 {
        font-size: 2rem;
    }
    
    .settings-grid {
        grid-template-columns: 1fr;
    }
    
    .cost-summary {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .setting-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .streaming-content {
        width: 95%;
        max-height: 90vh;
    }
    
    .streaming-header h3 {
        font-size: 1.1rem;
    }
    
    .streaming-body {
        padding: 15px;
        min-height: 250px;
    }
}
</style>
{% endblock %}
