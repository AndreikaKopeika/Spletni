# ✨ Улучшение сплетен с помощью AI

## Описание

Новая функция позволяет авторам сплетен улучшать свои публикации с помощью искусственного интеллекта GPT-4o-mini. За 100 сплетни коинов AI улучшит стиль написания, добавит форматирование Markdown и сделает текст более читаемым и увлекательным.

## Возможности

- **Улучшение стиля**: AI переписывает текст, делая его более читаемым и увлекательным
- **Markdown форматирование**: Добавляет заголовки, списки, выделения, цитаты
- **Структурирование**: Организует текст для лучшего восприятия
- **Безопасность**: Сохраняет оригинальную суть и не добавляет ложную информацию
- **Ограничения**: Каждая сплетня может быть улучшена только один раз

## Требования

- Автор сплетни должен иметь не менее 100 сплетни коинов
- Сплетня не должна быть уже улучшена с помощью AI
- Пользователь должен быть автором сплетни

## Установка и настройка

### 1. Обновление базы данных

Запустите скрипт для добавления новых полей в базу данных:

```bash
python update_database.py
```

### 2. Настройка OpenAI API

Убедитесь, что в файле `.env` установлен API ключ OpenAI:

```
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. Перезапуск приложения

Перезапустите приложение для применения изменений.

## Использование

1. Перейдите на страницу своей сплетни
2. Если у вас достаточно коинов (100+) и сплетня еще не улучшена, вы увидите кнопку "✨Улучшить с AI✨"
3. Нажмите на кнопку для запуска процесса улучшения
4. Дождитесь завершения обработки (обычно 5-10 секунд)
5. После успешного улучшения:
   - Содержимое сплетни будет обновлено
   - Кнопка улучшения исчезнет
   - Появится бейдж "Улучшено с помощью AI"
   - С вашего баланса спишется 100 коинов

## Безопасность

### Проверки на стороне сервера:
- ✅ Проверка прав доступа (только автор может улучшать)
- ✅ Проверка баланса коинов (минимум 100)
- ✅ Проверка статуса улучшения (только один раз)
- ✅ Rate limiting (5 запросов в час)
- ✅ Валидация и очистка контента
- ✅ Ограничение длины текста (максимум 10,000 символов)

### Защита от злоупотреблений:
- Ограничение количества запросов
- Проверка прав доступа
- Валидация входных данных
- Очистка HTML тегов

## Технические детали

### API Endpoint
```
POST /gossip/<gossip_id>/enhance_ai
```

### Параметры запроса
- `gossip_id` - ID сплетни для улучшения
- CSRF токен для защиты от атак

### Ответ API
```json
{
  "status": "success|error",
  "message": "Описание результата",
  "enhanced_content": "Улучшенный текст в Markdown",
  "enhanced_content_html": "HTML версия улучшенного текста",
  "remaining_coins": 150
}
```

### Новые поля в базе данных
- `is_ai_enhanced` (BOOLEAN) - флаг улучшения AI
- `ai_enhanced_at` (DATETIME) - время улучшения

## Стили и анимации

Кнопка улучшения имеет красивый градиентный фон с анимацией:
- Переливающиеся цвета
- Эффект подъема при наведении
- Индикатор загрузки во время обработки
- Плавные переходы

## Обработка ошибок

Система обрабатывает следующие ошибки:
- Недостаточно коинов
- Сплетня уже улучшена
- Отсутствие прав доступа
- Ошибки API OpenAI
- Сетевые ошибки

Все ошибки отображаются пользователю в виде уведомлений.

## Мониторинг

Для отслеживания использования функции можно добавить логирование:
- Количество улучшений
- Потребление коинов
- Ошибки API
- Время обработки

## Будущие улучшения

Возможные расширения функции:
- Различные стили улучшения
- Предварительный просмотр изменений
- Отмена улучшения (с возвратом части коинов)
- Статистика улучшений
- Интеграция с другими AI моделями
